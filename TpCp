--// Simplified Checkpoint Teleport GUI
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- Folder checkpoint
local checkpointFolder = workspace:FindFirstChild("Checkpoints")
if not checkpointFolder then
	warn("Folder 'Checkpoints' tidak ditemukan di Workspace!")
	checkpointFolder = Instance.new("Folder")
	checkpointFolder.Name = "Checkpoints"
	checkpointFolder.Parent = workspace
end

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TeleportGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 160, 0, 220)
Frame.Position = UDim2.new(0, 20, 0.4, -110)
Frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Frame.BorderSizePixel = 2
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

-- Title Bar
local titleBar = Instance.new("TextLabel")
titleBar.Size = UDim2.new(1, -25, 0, 25)
titleBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
titleBar.TextColor3 = Color3.fromRGB(255, 255, 255)
titleBar.Font = Enum.Font.SourceSansBold
titleBar.TextScaled = true
titleBar.Text = "I CAN BROKE UR GAME"
titleBar.Parent = Frame

-- Tombol Toggle (gabungan minimize/expand)
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 25, 0, 25)
toggleBtn.Position = UDim2.new(1, -25, 0, 0)
toggleBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Font = Enum.Font.SourceSansBold
toggleBtn.TextScaled = true
toggleBtn.Text = "-"
toggleBtn.Parent = Frame

-- Scrolling Frame (daftar checkpoint)
local Scroll = Instance.new("ScrollingFrame")
Scroll.Size = UDim2.new(1, 0, 1, -25)
Scroll.Position = UDim2.new(0, 0, 0, 25)
Scroll.BackgroundTransparency = 1
Scroll.BorderSizePixel = 0
Scroll.ScrollBarThickness = 6
Scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
Scroll.Parent = Frame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 3)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = Scroll

-- Tombol Close (sederhana)
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 20, 0, 20)
closeBtn.Position = UDim2.new(1, -22, 0, -22)
closeBtn.BackgroundColor3 = Color3.fromRGB(120, 30, 30)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.Text = "X"
closeBtn.Parent = Frame

-- Fungsi Util
local function getCFrameFor(obj)
	if not obj then return nil end
	if obj:IsA("BasePart") then
		return obj.CFrame
	elseif obj:IsA("Model") then
		if obj.PrimaryPart then
			return obj.PrimaryPart.CFrame
		else
			local sum, n = Vector3.new(0,0,0),0
			for _, v in ipairs(obj:GetDescendants()) do
				if v:IsA("BasePart") then
					sum += v.Position
					n += 1
				end
			end
			if n > 0 then return CFrame.new(sum / n) end
		end
	end
	return nil
end

local function teleportToCFrame(cf)
	local char = player.Character or player.CharacterAdded:Wait()
	local hrp = char:WaitForChild("HumanoidRootPart")
	if hrp and cf then
		local tween = TweenService:Create(hrp, TweenInfo.new(0.35, Enum.EasingStyle.Quad), {CFrame = cf + Vector3.new(0,3,0)})
		tween:Play()
	end
end

-- Scan checkpoints
local function scanCheckpoints(root)
	local items = {}
	for _, obj in ipairs(root:GetDescendants()) do
		if obj:IsA("Model") or obj:IsA("BasePart") then
			local cf = getCFrameFor(obj)
			table.insert(items,{name=obj.Name, instance=obj, cframe=cf})
		end
	end
	local function extractNumber(str)
		local s = string.match(str,"%d+")
		return tonumber(s) or math.huge
	end
	table.sort(items, function(a,b)
		local na, nb = extractNumber(a.name), extractNumber(b.name)
		return na == nb and a.name < b.name or na < nb
	end)
	return items
end

-- Populate daftar tombol checkpoint
local function populateList(list)
	for _, c in ipairs(Scroll:GetChildren()) do
		if not c:IsA("UIListLayout") then c:Destroy() end
	end
	for _, data in ipairs(list) do
		local btn = Instance.new("TextButton")
		btn.Size = UDim2.new(1,-8,0,24)
		btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
		btn.TextColor3 = Color3.fromRGB(255,255,255)
		btn.Font = Enum.Font.SourceSans
		btn.TextScaled = true
		btn.Text = data.name
		btn.Parent = Scroll
		btn.MouseButton1Click:Connect(function()
			if data.cframe then
				teleportToCFrame(data.cframe)
			else
				warn("Checkpoint "..data.name.." tidak punya CFrame!")
			end
		end)
	end
	Scroll.CanvasSize = UDim2.new(0,0,0,UIListLayout.AbsoluteContentSize.Y + 6)
end

-- Init
local checkpoints = scanCheckpoints(checkpointFolder)
populateList(checkpoints)

-- Update otomatis
RunService.Heartbeat:Connect(function()
	local newList = scanCheckpoints(checkpointFolder)
	local changed = #newList ~= #checkpoints
	if not changed then
		for i=1,#newList do
			if newList[i].name ~= checkpoints[i].name then
				changed = true
				break
			end
		end
	end
	if changed then
		checkpoints = newList
		populateList(checkpoints)
	end
end)

-- Tombol fungsi
local minimized = false
toggleBtn.MouseButton1Click:Connect(function()
	minimized = not minimized
	if minimized then
		Scroll.Visible = false
		Frame.Size = UDim2.new(0,160,0,25)
		toggleBtn.Text = "+"
	else
		Scroll.Visible = true
		Frame.Size = UDim2.new(0,160,0,220)
		toggleBtn.Text = "-"
	end
end)

closeBtn.MouseButton1Click:Connect(function()
	ScreenGui:Destroy()
end)
